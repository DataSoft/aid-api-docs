<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Automatic Injury Detection API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;java&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="java">java</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>This document describes the API for accessing the Automatic Injury Detection devices from third party Android applications.  Requires version 1.6.1 or later of the AID <a href="https://play.google.com/store/apps/details?id=datasoft.com.aid">application</a>.</p>

<p>There is also a bare bones example API test <a href="https://github.com/DataSoft/AIDAPItest">app</a>.</p>

<h1 id="intents">Intents</h1>
<pre class="highlight java"><code><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"datasoft.com.aid"</span><span class="o">,</span> <span class="s">"com.datasoft.aid.ConnectionService"</span><span class="o">);</span>
</code></pre>

<blockquote>
<p>Note that the package name for AID apk is <code class="prettyprint">datasoft.com.aid</code> and not <code class="prettyprint">com.datasoft.aid</code>.</p>
</blockquote>

<p>Communications to the AID ConnectionService is done by <code class="prettyprint">startService</code> with an explicit intent.  Use of implicit intents with intent filters is no longer available in Android 5.0+.  Use <code class="prettyprint">Intent.setClassName</code> with a package name of <code class="prettyprint">datasoft.com.aid</code> and a class name of <code class="prettyprint">com.datasoft.aid.ConnectionService</code> for all commands going to the AID ConnectionService.  The service returns all responses as Broadcast Intents.</p>

<h3 id="commands">Commands</h3>

<p>Commands supported so far by the service:</p>

<ul>
<li>com.datasoft.aid.action.GET_STATUS</li>
<li>com.datasoft.aid.action.START_SCAN</li>
<li>com.datasoft.aid.action.STOP_SCAN</li>
</ul>

<h3 id="events">Events</h3>

<p>Events reported by the service (broadcast intents):</p>

<ul>
<li>com.datasoft.aid.event.UPDATE_STATUS</li>
<li>com.datasoft.aid.event.DEVICE_FOUND</li>
<li>com.datasoft.aid.event.DEVICE_CONNECTED</li>
<li>com.datasoft.aid.event.DEVICE_DISCONNECTED</li>
<li>com.datasoft.aid.event.INJURY</li>
</ul>

<h1 id="scanning-for-devices">Scanning for Devices</h1>

<h2 id="start-scanning">Start Scanning</h2>

<p>Use the com.datasoft.aid.action.START_SCAN action to scan for devices.  This will disconnect any currently connected devices while scanning.  There is currently not terribly useful because there isn&rsquo;t a way to select the AID devices using the API.</p>
<pre class="highlight java"><code><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="s">"com.datasoft.aid.action.START_SCAN"</span><span class="o">);</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"datasoft.com.aid"</span><span class="o">,</span> <span class="s">"com.datasoft.aid.ConnectionService"</span><span class="o">);</span>
<span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</code></pre>

<h2 id="device-found">Device Found</h2>

<p>While scanning, devices are returned with a BroadcastIntent with action com.datasoft.aid.event.DEVICE_FOUND.  The service reports every device advertisement seen, it&rsquo;s up to the client to keep track of duplicates.  Device name and address are included in the Intent&rsquo;s extras bundle.</p>

<h3 id="device_found-parameters">DEVICE_FOUND parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>device-address</td>
<td>String</td>
<td>BLE address of the AID device</td>
</tr>
<tr>
<td>device-name</td>
<td>String</td>
<td>Advertised name of the AID device</td>
</tr>
</tbody></table>
<pre class="highlight java"><code><span class="n">BroadcastReceiver</span> <span class="n">deviceFoundReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">address</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"device-address"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"device-name"</span><span class="o">);</span>
        <span class="c1">// Do stuff..</span>
    <span class="o">}</span>
<span class="o">};</span>
<span class="n">IntentFilter</span> <span class="n">deviceFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="s">"com.datasoft.aid.event.DEVICE_FOUND"</span><span class="o">);</span>
<span class="n">registerReceiver</span><span class="o">(</span><span class="n">deviceFoundReceiver</span><span class="o">,</span> <span class="n">deviceFilter</span><span class="o">);</span>
</code></pre>

<h2 id="stop-scanning">Stop Scanning</h2>

<p>To stop scanning for devices, use a com.datasoft.aid.action.STOP_SCAN action.</p>
<pre class="highlight java"><code><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="s">"com.datasoft.aid.action.STOP_SCAN"</span><span class="o">);</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"datasoft.com.aid"</span><span class="o">,</span> <span class="s">"com.datasoft.aid.ConnectionService"</span><span class="o">);</span>
<span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</code></pre>

<h1 id="device-status">Device Status</h1>

<p>To get the status of AID devices, send a com.datasoft.aid.action.GET_STATUS action.</p>
<pre class="highlight java"><code><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="s">"com.datasoft.aid.action.GET_STATUS"</span><span class="o">);</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"datasoft.com.aid"</span><span class="o">,</span> <span class="s">"com.datasoft.aid.ConnectionService"</span><span class="o">);</span>
<span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</code></pre>

<h2 id="status-results">Status results</h2>

<p>The service sends a com.datasoft.aid.event.UPDATE_STATUS BroadcastIntent in response.  Device status fields are in the Intent&rsquo;s extras bundle.</p>

<h3 id="update_status-parameters">UPDATE_STATUS parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>front-device-name</td>
<td>String</td>
<td>Advertised name of AID device attached to front of the vest</td>
</tr>
<tr>
<td>front-device-address</td>
<td>String</td>
<td>BLE address of front device</td>
</tr>
<tr>
<td>front-device-connected</td>
<td>boolean</td>
<td>True if phone is currently connected to this device</td>
</tr>
<tr>
<td>front-device-battery</td>
<td>int</td>
<td>Battery level of device in percent</td>
</tr>
<tr>
<td>front-device-injury</td>
<td>int</td>
<td>Injury status: 1=Upper panel, 2=Lower panel, 3=Both</td>
</tr>
<tr>
<td>back-device-name</td>
<td>String</td>
<td>Advertised name of AID device attached to back of the vest</td>
</tr>
<tr>
<td>back-device-address</td>
<td>String</td>
<td>BLE address of back device</td>
</tr>
<tr>
<td>back-device-connected</td>
<td>boolean</td>
<td>True if phone is currently connected to this device</td>
</tr>
<tr>
<td>back-device-battery</td>
<td>int</td>
<td>Battery level of device in percent</td>
</tr>
<tr>
<td>back-device-injury</td>
<td>int</td>
<td>Injury status: 1=Upper panel, 2=Lower panel, 3=Both</td>
</tr>
</tbody></table>
<pre class="highlight java"><code><span class="n">BroadcastReceiver</span> <span class="n">statusReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">frontName</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"front-device-name"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">frontAddress</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"front-device-address"</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">frontConnected</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getBooleanExtra</span><span class="o">(</span><span class="s">"front-device-connected"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">frontBattery</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getIntExtra</span><span class="o">(</span><span class="s">"front-device-battery"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">frontInjury</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getIntExtra</span><span class="o">(</span><span class="s">"front-device-injury"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">backName</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"back-device-name"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">backAddress</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"back-device-address"</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">backConnected</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getBooleanExtra</span><span class="o">(</span><span class="s">"back-device-connected"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">backBattery</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getIntExtra</span><span class="o">(</span><span class="s">"back-device-battery"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">backInjury</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getIntExtra</span><span class="o">(</span><span class="s">"back-device-injury"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>

        <span class="c1">// Do stuff..</span>
    <span class="o">}</span>
<span class="o">};</span>
<span class="n">IntentFilter</span> <span class="n">statusFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="s">"com.datasoft.aid.event.UPDATE_STATUS"</span><span class="o">);</span>
<span class="n">registerReceiver</span><span class="o">(</span><span class="n">statusReceiver</span><span class="o">,</span> <span class="n">statusFilter</span><span class="o">);</span>
</code></pre>

<h1 id="other-device-events">Other Device Events</h1>

<p>These events are broadcast based on device events and not as a response to an action.</p>

<h2 id="device-disconnected">Device Disconnected</h2>

<p>The com.datasoft.aid.event.DEVICE_DISCONNECTED event notifies the client that the AID devices are no longer connected to the service.  For example, when the phone goes out of range of the devices.  No extra data is included in this intent.</p>
<pre class="highlight java"><code><span class="n">BroadcastReceiver</span> <span class="n">disconnectedReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"AID Devices have been disconnected"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">};</span>
<span class="n">IntentFilter</span> <span class="n">disconnectedFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="s">"com.datasoft.aid.event.DEVICE_DISCONNECTED"</span><span class="o">);</span>
<span class="n">registerReceiver</span><span class="o">(</span><span class="n">disconnectedReceiver</span><span class="o">,</span> <span class="n">disconnectedFilter</span><span class="o">);</span>
</code></pre>

<h2 id="device-connected">Device Connected</h2>

<p>The com.datasoft.aid.event.DEVICE_CONNECTED event notifies the client that the AID devices are both connected to the service.  No extra data is included in this intent.</p>
<pre class="highlight java"><code><span class="n">BroadcastReceiver</span> <span class="n">connectedReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"AID Devices have been connected"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">};</span>
<span class="n">IntentFilter</span> <span class="n">connectedFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="s">"com.datasoft.aid.event.DEVICE_CONNECTED"</span><span class="o">);</span>
<span class="n">registerReceiver</span><span class="o">(</span><span class="n">connectedReceiver</span><span class="o">,</span> <span class="n">connectedFilter</span><span class="o">);</span>
</code></pre>

<h2 id="injury-detected">Injury Detected</h2>

<p>The com.datasoft.aid.event.INJURY event notifies the client that one of the AID devices has detected a piercing event.  The injury location is included in the intent&rsquo;s extras bundle.</p>

<h3 id="injury-parameters">INJURY parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>front-upper</td>
<td>boolean</td>
<td>True if the upper part of the front panel has been pierced.</td>
</tr>
<tr>
<td>front-lower</td>
<td>boolean</td>
<td>True if the lower part of the front panel has been pierced.</td>
</tr>
<tr>
<td>back-upper</td>
<td>boolean</td>
<td>True if the upper part of the back panel has been pierced.</td>
</tr>
<tr>
<td>back-lower</td>
<td>boolean</td>
<td>True if the lower part of the back panel has been pierced.</td>
</tr>
</tbody></table>
<pre class="highlight java"><code><span class="n">BroadcastReceiver</span> <span class="n">injuryReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">frontUpper</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getBooleanExtra</span><span class="o">(</span><span class="s">"front-upper"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">frontLower</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getBooleanExtra</span><span class="o">(</span><span class="s">"front-lower"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">backUpper</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getBooleanExtra</span><span class="o">(</span><span class="s">"back-upper"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">backLower</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getBooleanExtra</span><span class="o">(</span><span class="s">"back-lower"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="c1">// Do stuff</span>
    <span class="o">}</span>
<span class="o">};</span>
<span class="n">IntentFilter</span> <span class="n">injuryFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="s">"com.datasoft.aid.event.INJURY"</span><span class="o">);</span>
<span class="n">registerReceiver</span><span class="o">(</span><span class="n">injuryReceiver</span><span class="o">,</span> <span class="n">injuryFilter</span><span class="o">);</span>
</code></pre>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="java">java</a>
          </div>
      </div>
    </div>
  </body>
</html>
